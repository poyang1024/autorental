<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <title>訂單資料 / 查看資料 </title>
    <meta content="width=device-width, initial-scale=1.0" name="viewport">
    <meta content="" name="keywords">
    <meta content="" name="description">

    <!-- Favicon -->
    <link href="../../img/favicon.ico" rel="icon">

    <!-- Google Web Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Heebo:wght@400;500;600;700&display=swap" rel="stylesheet">

    <!-- Icon Font Stylesheet -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.10.0/css/all.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.4.1/font/bootstrap-icons.css" rel="stylesheet">

    <!-- Libraries Stylesheet -->
    <link href="../../css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="../../css/toastr.min.css">

    <!-- DataTable Stylesheet -->
    <link rel="stylesheet" href="../../css/dataTables.bootstrap5.min.css">

    <!-- Template Stylesheet -->
    <link href="../../css/style.css" rel="stylesheet">

    <style>
        .form-label {
            display: flex;
            align-items: center;
            justify-content: flex-end;
            padding-right: 10px;
            margin-bottom: 0;
            height: 100%;
        }
        .form-control-sm, .form-select-sm {
            height: 31px;
        }
        .mb-2 {
            margin-bottom: 0.25rem !important;
        }
    </style>

</head>

<body>
    <div class="container-fluid position-relative bg-white d-flex p-0">
        <!-- Spinner Start -->
        <div id="spinner"
            class="show bg-white position-fixed translate-middle w-100 vh-100 top-50 start-50 d-flex align-items-center justify-content-center">
            <div class="spinner-border text-primary" style="width: 3rem; height: 3rem;" role="status">
                <span class="sr-only">Loading...</span>
            </div>
        </div>
        <!-- Spinner End -->


        <!-- Sidebar Start -->
        <div class="sidebar pe-4 pb-3">
            <nav class="navbar bg-light navbar-light">
                <a href="../index.html" class="navbar-brand mx-4 mb-3">
                    <h3 class="text-primary">電動車後台管理</h3>
                </a>
                <div class="navbar-nav w-100" id="dynamicMenu">
                </div>
            </nav>
        </div>
        <!-- Sidebar End -->


        <!-- Content Start -->
        <div class="content">
            <!-- Navbar Start -->
            <nav class="navbar navbar-expand bg-light navbar-light sticky-top px-4 py-0">
                <a href="../index.html" class="navbar-brand d-flex d-lg-none me-4">
                    <h2 class="text-primary mb-0"><i class="fa fa-hashtag"></i></h2>
                </a>
                <a href="#" class="sidebar-toggler flex-shrink-0">
                    <i class="fa fa-bars"></i>
                </a>

                <div class="navbar-nav align-items-center ms-auto">

                    <div class="nav-item">
                        <a href="notificationList.html" class="nav-link position-relative">
                            <i class="fa fa-bell me-lg-2"></i>
                            <span
                                class="position-absolute top-30 start-60 translate-middle badge rounded-pill bg-danger"
                                id="unreadMsgNum">
                                <span class="visually-hidden">unread messages</span>
                            </span>
                        </a>
                    </div>
                    <div class="nav-item dropdown">
                        <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown">
                            <img class="userImg rounded-circle me-lg-2" src="../../img/user.jpg" alt=""
                                style="width: 40px; height: 40px;">
                            <span class="d-none d-lg-inline-flex" id="userName">John Doe</span>
                        </a>
                        <div
                            class="dropdown-menu dropdown-menu-end bg-body-secondary border-0 rounded-0 rounded-bottom m-0">
                            <a href="#" class="dropdown-item" id="logout">Log Out</a>
                        </div>
                    </div>
                </div>
            </nav>
            <!-- Navbar End -->


            <!-- Blank Start -->
            <div class="container-fluid pt-4 px-4">
                <div class="row  bg-light rounded p-3 mx-0">
                    <h3>訂單資料</h3>
                    <nav aria-label="breadcrumb">
                        <ol class="breadcrumb">
                            <li class="breadcrumb-item"><a href="orderList.html">訂單管理</a></li>
                            <li class="breadcrumb-item active" aria-current="page">訂單資料 / 查看</li>
                        </ol>
                    </nav>
                    
                    <div class="row mt-2">
                        <!-- 訂單車型的照片
                        <div class="col-md-3">
                            <div class="card">
                                <img id="orderPhoto" class="card-img-top" alt="車型照片" style="width: 100%; height: auto;">
                            </div>
                        </div>

                        <hr class="my-4"> -->
                        
                        <!-- 訂單詳細信息 -->
                        <div class="col-md-12">
                            <div class="row">
                                <!-- 車籍資料 -->
                                <div class="col-md-3">
                                    <h5>車籍資料</h5>
                                    <div class="mb-2 row">
                                        <label class="col-sm-4 col-form-label">品牌</label>
                                        <div class="col-sm-8">
                                            <input type="text" class="form-control form-control-sm" id="brand" disabled>
                                        </div>
                                    </div>
                                    <div class="mb-2 row">
                                        <label class="col-sm-4 col-form-label">車型</label>
                                        <div class="col-sm-8">
                                            <input type="text" class="form-control form-control-sm" id="model" disabled>
                                        </div>
                                    </div>
                                    <div class="mb-2 row">
                                        <label class="col-sm-4 col-form-label">車牌</label>
                                        <div class="col-sm-8">
                                            <input type="text" class="form-control form-control-sm" id="plate" disabled>
                                        </div>
                                    </div>
                                    <div class="mb-2 row">
                                        <label class="col-sm-4 col-form-label">駕照等級</label>
                                        <div class="col-sm-8">
                                            <input type="text" class="form-control form-control-sm" id="licenseType" disabled>
                                        </div>
                                    </div>
                                    <div class="mb-2 row">
                                        <label class="col-sm-4 col-form-label">取車里程</label>
                                        <div class="col-sm-8">
                                            <input type="text" class="form-control form-control-sm" id="pickupDistance" disabled>
                                        </div>
                                    </div>
                                    <div class="mb-2 row">
                                        <label class="col-sm-4 col-form-label">還車里程</label>
                                        <div class="col-sm-8">
                                            <input type="text" class="form-control form-control-sm" id="returnDistance" disabled>
                                        </div>
                                    </div>
                                </div>
                                
                                <!-- 會員資料 -->
                                <div class="col-md-3">
                                    <h5>會員資料</h5>
                                    <div class="mb-2 row">
                                        <label class="col-sm-4 col-form-label">姓名</label>
                                        <div class="col-sm-8">
                                            <input type="text" class="form-control form-control-sm" id="name" disabled>
                                        </div>
                                    </div>
                                    <div class="mb-2 row">
                                        <label class="col-sm-4 col-form-label">生日</label>
                                        <div class="col-sm-8">
                                            <input type="text" class="form-control form-control-sm" id="birthdate" disabled>
                                        </div>
                                    </div>
                                    <div class="mb-2 row">
                                        <label class="col-sm-4 col-form-label">手機</label>
                                        <div class="col-sm-8">
                                            <input type="text" class="form-control form-control-sm" id="phone" disabled>
                                        </div>
                                    </div>
                                    <div class="mb-2 row">
                                        <label class="col-sm-4 col-form-label">擁有駕照</label>
                                        <div class="col-sm-8">
                                            <input type="text" class="form-control form-control-sm" id="licenseHeld" disabled>
                                        </div>
                                    </div>
                                    <div class="mb-2 row">
                                        <label class="col-sm-4 col-form-label">會員累計里程</label>
                                        <div class="col-sm-8">
                                            <input type="text" class="form-control form-control-sm" id="totalDistance" disabled>
                                        </div>
                                    </div>
                                </div>

                                <!-- 取車資訊 -->
                                <div class="col-md-3">
                                    <h5>取車資訊</h5>
                                    <div class="mb-2 row">
                                        <label class="col-sm-4 col-form-label">出發時間</label>
                                        <div class="col-sm-8">
                                            <input type="text" class="form-control form-control-sm" id="pickupTime" disabled>
                                        </div>
                                    </div>
                                    <div class="mb-2 row">
                                        <label class="col-sm-4 col-form-label">結束時間</label>
                                        <div class="col-sm-8">
                                            <input type="text" class="form-control form-control-sm" id="returnTime" disabled>
                                        </div>
                                    </div>
                                    <div class="mb-2 row">
                                        <label class="col-sm-4 col-form-label">實際取車時間</label>
                                        <div class="col-sm-8">
                                            <input type="text" class="form-control form-control-sm" id="actualPickupTime" disabled>
                                        </div>
                                    </div>
                                    <div class="mb-2 row">
                                        <label class="col-sm-4 col-form-label">實際還車時間</label>
                                        <div class="col-sm-8">
                                            <input type="text" class="form-control form-control-sm" id="actualReturnTime" disabled>
                                        </div>
                                    </div>
                                    <div class="mb-2 row">
                                        <label class="col-sm-4 col-form-label">租車公司</label>
                                        <div class="col-sm-8">
                                            <input type="text" class="form-control form-control-sm" id="rentalCompany" disabled>
                                        </div>
                                    </div>
                                    <div class="mb-2 row">
                                        <label class="col-sm-4 col-form-label">取車站點</label>
                                        <div class="col-sm-8">
                                            <input type="text" class="form-control form-control-sm" id="pickupLocation" disabled>
                                        </div>
                                    </div>
                                    <div class="mb-2 row">
                                        <label class="col-sm-4 col-form-label">還車站點</label>
                                        <div class="col-sm-8">
                                            <input type="text" class="form-control form-control-sm" id="returnSiteName" disabled>
                                        </div>
                                    </div>
                                    <div class="mb-2 row">
                                        <label class="col-sm-4 col-form-label">實際取車站點</label>
                                        <div class="col-sm-8">
                                            <input type="text" class="form-control form-control-sm" id="realPickSiteName" disabled>
                                        </div>
                                    </div>
                                    <div class="mb-2 row">
                                        <label class="col-sm-4 col-form-label">實際還車站點</label>
                                        <div class="col-sm-8">
                                            <input type="text" class="form-control form-control-sm" id="realReturnSiteName" disabled>
                                        </div>
                                    </div>
                                </div>
                
                                <!-- 訂單資訊 (新添加的部分) -->
                                <div class="col-md-3">
                                    <h5>訂單資訊</h5>
                                    <div class="mb-2 row">
                                        <label class="col-sm-4 col-form-label">訂單編號</label>
                                        <div class="col-sm-8">
                                            <input type="text" class="form-control form-control-sm" id="orderId" disabled>
                                        </div>
                                    </div>
                                    <div class="mb-2 row">
                                        <label class="col-sm-4 col-form-label">成立時間</label>
                                        <div class="col-sm-8">
                                            <input type="text" class="form-control form-control-sm" id="orderTime" disabled>
                                        </div>
                                    </div>
                                    <div class="mb-2 row">
                                        <label class="col-sm-4 col-form-label">方案名稱</label>
                                        <div class="col-sm-8">
                                            <input type="text" class="form-control form-control-sm" id="planName" disabled>
                                        </div>
                                    </div>
                                    <div class="mb-2 row">
                                        <label class="col-sm-4 col-form-label">方案數量</label>
                                        <div class="col-sm-8">
                                            <input type="text" class="form-control form-control-sm" id="planQuantity" disabled>
                                        </div>
                                    </div>
                                    <div class="mb-2 row">
                                        <label class="col-sm-4 col-form-label">使用時數</label>
                                        <div class="col-sm-8">
                                            <input type="text" class="form-control form-control-sm" id="usageHours" disabled>
                                        </div>
                                    </div>
                                    <div class="mb-2 row">
                                        <label class="col-sm-4 col-form-label">訂金</label>
                                        <div class="col-sm-8">
                                            <input type="text" class="form-control form-control-sm" id="orderAmount" disabled>
                                        </div>
                                    </div>
                                    <div class="mb-2 row">
                                        <label class="col-sm-4 col-form-label">還車費用</label>
                                        <div class="col-sm-8">
                                            <input type="text" class="form-control form-control-sm" id="returnFee" disabled>
                                        </div>
                                    </div>
                                    <div class="mb-2 row">
                                        <label class="col-sm-4 col-form-label">總金額</label>
                                        <div class="col-sm-8">
                                            <input type="text" class="form-control form-control-sm" id="totalAmount" disabled>
                                        </div>
                                    </div>
                                    <div class="mb-2 row">
                                        <label class="col-sm-4 col-form-label">訂單狀態</label>
                                        <div class="col-sm-8">
                                            <input type="text" class="form-control form-control-sm" id="orderStatus" disabled>
                                        </div>
                                    </div>
                                    <div class="mb-2 row">
                                        <label class="col-sm-4 col-form-label">訂單備註</label>
                                        <div class="col-sm-8">
                                            <textarea type="text" class="form-control form-control-m" id="orderRemark"></textarea>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- 訂單明細 -->
                    <div class="block-first">
                        <div class="tableList">
                            <h5>訂單明細</h5>
                            <div class="table-responsive">
                                <table id= "orderDetailList" class="display table table-striped">
                                    <thead>
                                        <tr>
                                            <th>費用類型</th>
                                            <th>金額</th>
                                            <th>備註</th>
                                            <th>付款方式</th>
                                            <th>Tappay交易識別碼</th>
                                            <th>交易狀態</th>
                                            <th>操作人</th>
                                            <th>更新時間</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <!-- 這裡將通過 JavaScript 動態填充訂單明細 -->
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                    
                    <hr class="my-4">

                    <!-- 發票明細 -->
                    <div class="block-first">
                        <div class="tableList">
                            <h5>發票明細</h5>
                            <div class="table-responsive">
                                <table id= "invoiceList" class="display table table-striped">
                                    <thead>
                                        <tr>
                                            <th>發票號碼</th>
                                            <th>開立時間</th>
                                            <th>發票面額</th>
                                            <th>發票狀態</th>
                                            <th>更新時間</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <!-- 這裡將通過 JavaScript 動態填充訂單明細 -->
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                    
                    <!-- 按鈕區域 -->
                    <div class="row mt-4">
                        <div class="col-12 text-center">
                            <button id="viewMapButton" class="btn btn-primary me-2">查看地圖軌跡</button>
                            <button id="orderAppealModalBtn" class="btn btn-primary me-2" data-bs-toggle="modal" data-bs-target="#orderAppealModal">訂單申訴</button>
                            <button id="cancelOrderModalBtn" class="btn btn-danger me-2" data-bs-toggle="modal" data-bs-target="#cancelOrderModal">訂單取消</button>
                            <button id="interruptPowerModalBtn" class="btn btn-danger me-2" data-bs-toggle="modal" data-bs-target="#interruptPowerModal">中斷電源</button>
                        </div>
                    </div>

                    <div class="text-center w-100 pt-3">
                        <button id="backButton" class="w-25 btn btn-primary btn-md"
                            type="button">上一頁</button>
                    </div>

                    <!-- 行車路線軌跡 popup -->
                    <div class="modal fade" id="mapModal" tabindex="-1" aria-labelledby="mapModalLabel" aria-hidden="true">
                        <div class="modal-dialog modal-lg modal-dialog-centered">
                            <div class="modal-content">
                                <div class="modal-header">
                                    <h5 class="modal-title" id="mapModalLabel">地圖軌跡</h5>
                                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                                </div>
                                <div class="modal-body">
                                    <div id="map" style="height: 400px;"></div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="modal fade" id="orderAppealModal" tabindex="-1" aria-labelledby="orderAppealModalLabel" aria-hidden="true">
                        <div class="modal-dialog modal-lg">
                            <div class="modal-content">
                                <div class="modal-header">
                                    <h5 class="modal-title" id="orderAppealModalLabel">訂單申訴</h5>
                                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                                </div>
                                <div class="modal-body">
                                    <form id="orderAppealForm">
                                        <div class="row">
                                            <div class="col-md-6">
                                                <div class="mb-3">
                                                    <label for="discountAmount" class="form-label">*折扣金額</label>
                                                    <input type="number" class="form-control" id="discountAmount" name="discountAmount" min="0" step="1" required>
                                                </div>
                                            </div>
                                            <div class="col-md-6">
                                                <div class="mb-3">
                                                    <label for="orderRemarks" class="form-label">*訂單明細-備註</label>
                                                    <textarea class="form-control" id="orderRemarks" name="orderRemarks" rows="3" required></textarea>
                                                </div>
                                            </div>
                                        </div>
                                    </form>
                                </div>
                                <div class="modal-footer">
                                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">取消</button>
                                    <button type="button" class="btn btn-primary" id="submitAppeal">提交</button>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Order Cancellation Confirmation Modal -->
                    <div class="modal fade" id="cancelOrderModal" tabindex="-1" aria-labelledby="cancelOrderModalLabel" aria-hidden="true">
                        <div class="modal-dialog">
                            <div class="modal-content">
                                <div class="modal-header">
                                    <h5 class="modal-title" id="cancelOrderModalLabel"></h5>
                                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                                </div>
                                <div class="modal-body" id="cancelmessage">
                                    
                                </div>
                                <div class="modal-footer">
                                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">取消</button>
                                    <button type="button" class="btn btn-danger" id="confirmCancelOrder">確認取消</button>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Power Interruption Confirmation Modal -->
                    <div class="modal fade" id="interruptPowerModal" tabindex="-1" aria-labelledby="interruptPowerModalLabel" aria-hidden="true">
                        <div class="modal-dialog">
                            <div class="modal-content">
                                <div class="modal-header">
                                    <h5 class="modal-title" id="interruptPowerModalLabel">確認中斷電源</h5>
                                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                                </div>
                                <div class="modal-body">
                                    [緊急使用] <br>中斷電源會立即中止此車輛的電源，可能造成騎車者危險，並將訂單狀態改成已中斷，是否要中斷電源？
                                </div>
                                <div class="modal-footer">
                                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">取消</button>
                                    <button type="button" class="btn btn-danger" id="confirmInterruptPower">確認中斷</button>
                                </div>
                            </div>
                        </div>
                    </div>

                </div>

                <!-- <hr class="my-4">
                <h4>系統資料</h4>
                <div class="row g-3 mb-5">
                    <div class="col-sm-4">
                        <label for="BuildTime" class="form-label">建立時間</label>
                        <input type="text" class="form-control" id="BuildTime" disabled>
                    </div>

                    <div class="col-sm-4">
                        <label for="EditTime" class="form-label">修改時間</label>
                        <input type="text" class="form-control" id="EditTime" disabled>
                    </div>

                    <div class="col-sm-4">
                        <label for="EditAccount" class="form-label">修改帳號</label>
                        <input type="text" class="form-control" id="EditAccount" disabled>
                    </div>
                </div> -->
            </div>
            <!-- Blank End -->


            <!-- Footer Start -->
            <!-- Footer End -->
        </div>
        <!-- Content End -->


        <!-- Back to Top -->
        <a href="#" class="btn btn-lg btn-primary btn-lg-square back-to-top"><i class="bi bi-arrow-up"></i></a>
    </div>

    <!--  Boostrap JavaScript Libraries -->
    <script src="../../js/jquery-3.7.1.min.js"></script>
    <script src="../../js/bootstrap.bundle.min.js"></script>
    <script src="../../js/Login/Authlogin.js"></script>
    <script src="../../js/Notifications/notifications.js"></script>
    <script src="../../js/Notifications/api-notifications.js"></script>
    <script src="../../js/crypto-js.js"></script>
    <script src="../../js/toastr.min.js"></script>
    <script src="../../js/Notifications/notifications.js"></script>
    <script src="../../js/Notifications/toastr-options.js"></script>


    <!-- Template Javascript -->
    <script src="../../config/api-config.js"></script>
    <script src="../../js/main.js"></script>

    <script src="../../js/Public/menu.js"></script>
    <script src="../../js/Order/OrderList_read.js"></script>

    <!-- 權限 -->
    <script src="../../js/Public/permissionControl.js"></script>
    <script src="../../js/Public/Auth_Read.js"></script>
    <script src="../../js/Public/order_Auth.js"></script>

    <!-- Datatable Libraries -->
    <script src="../../js/jquery.dataTables.min.js"></script>
    <script src="../../js/dataTables.bootstrap5.js"></script>
    
    <!-- <script>
        $(document).ready(function () {
            // 輸入 list
            new DataTable('#orderDetailList', {
                scrollX: true
            });
            new DataTable('#invoiceList', {
                scrollX: true
            });
        });
    </script> -->
    

    <script>
        document.getElementById("backButton").addEventListener("click", function () {
            //這邊removeItem裡面要改
            sessionStorage.removeItem("readOrderId");
            history.back();
        });
    </script>

    <!-- 加载 Google Maps JavaScript API -->
    <script>
        (g=>{var h,a,k,p="The Google Maps JavaScript API",c="google",l="importLibrary",q="__ib__",m=document,b=window;b=b[c]||(b[c]={});var d=b.maps||(b.maps={}),r=new Set,e=new URLSearchParams,u=()=>h||(h=new Promise(async(f,n)=>{await (a=m.createElement("script"));e.set("libraries",[...r]+"");for(k in g)e.set(k.replace(/[A-Z]/g,t=>"_"+t[0].toLowerCase()),g[k]);e.set("callback",c+".maps."+q);a.src=`https://maps.${c}apis.com/maps/api/js?`+e;d[q]=f;a.onerror=()=>h=n(Error(p+" could not load."));a.nonce=m.querySelector("script[nonce]")?.nonce||"";m.head.append(a)}));d[l]?console.warn(p+" only loads once. Ignoring:",g):d[l]=(f,...n)=>r.add(f)&&u().then(()=>d[l](f,...n))})
        ({key: mapApiKey, v: "weekly"});
    </script>

    <script src="../../js/carMap/carMapRoute.js"></script>

    <style>
        .modal-xl {
            max-width: 90%;
            width: 90%;
        }
        
        #map {
            width: 100%;
            height: 70vh;
        }
        
        @media (max-width: 992px) {
            .modal-xl {
                max-width: 95%;
                width: 95%;
            }
        }
    </style>

</body>

</html>
